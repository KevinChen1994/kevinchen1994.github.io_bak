---
title: "å¤§æ¨¡å‹çš„åˆ†è¯ç®—æ³•"
date: "2023-12-06T02:33:00.000Z"
lastmod: "2023-12-06T06:28:00.000Z"
draft: false
featuredImage: "https://prod-files-secure.s3.us-west-2.amazonaws.com/d7dbc101-8\
  2ce-4f96-ae1a-879bd6c9f3a6/cbbc7f52-197c-4106-9b0f-71c5c7070468/tok_hf.png?X-\
  Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Cr\
  edential=ASIAZI2LB466WOIGWCQV%2F20250212%2Fus-west-2%2Fs3%2Faws4_request&X-Am\
  z-Date=20250212T111944Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX\
  2VjEM%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQC7Zx0GbWFzC7kK\
  09Lmo40cvDQhFb%2FN2Vz1OjGG4KzTyQIgUa8f4rY5giXSBpWAvTRdKG3HyQUwWX%2BVEQTLPT0GD\
  IEqiAQI6P%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDEeOJQHKpUzOs6\
  dgtircA3%2BQJ2PbiJvvAwzMYgqnLVmvp4oTr0ULJRw5rAMVBjM2jlUwfphMzPhOt47Vk%2Bjub7k\
  Gt95D4R5Dnp4m12WTyINoWkSf014daeTDBRa%2BqO7Wsfj1XEPAQJeZdBEaLmaNUJvpHY1oYGPw8M\
  rEAghnhUpi0Mqz8E9PBG9WUVpSWLvkkMQN1rTIkBgV5GZRWmaINhq%2B9VyDFlZUcc2%2F0fzdZDL\
  m%2Frkt8IDfZORebXDlmtSyB8lhb1GxY4Q2rNyVZDeMa9orBahVC8myr1RhmhCPS%2F4ul1rNwJKV\
  Wb8ls%2BJpMvv94ituhpj00NZnFVqkbNYI7Dl9XW38%2Feq3NePV8VjroGVQGPMs2V6eDUuGowWWF\
  66i4GMl%2Bg%2F%2FJ%2BVq6%2Bpn29JoYbmoWf%2BqwAM%2Ff2NR9gA15oVCO%2BEqR%2B%2B%2B\
  U0cRQeS6EcY%2FYTHZSleMM8aJ%2BYglT%2Fzuj%2FQgXS0uMwIlDgCIxMyvdRnSWrvZWniLdQGpi\
  AXvFvd9soVVvY98nICHbPzSdAi5KSLbs8vWAyisgAmP4LDVtu14K0C2R6P8nmIW08VemwZM%2FQx3\
  18yxGtSGCabkG0e3%2BC6AKUp3IhxL%2FU78gBQ1lTGTWsUOYewbABsQMqfW3yA%2FZMM3oJgd0Vu\
  LUEa0MIiOsb0GOqUBFhA%2FosDn%2FTP%2FoTbDznog3V2UGYXASH5ky8AvVleAmHsp%2B6ije9dl\
  tlHqo%2B4XT60avEOWT12g4aPU5kehgoNAWtCo2aOaKNpcvNOb%2BzV5ObVznrbfSZDrqvjfXM3fU\
  5UGambLZdmCxCs8%2BYqSLjq8Xw2ZtqqkG2s0RfopoiBakEYFKmpx6qZtTkNOaJxSrSYBbEhg8tqZ\
  Huk1%2B1zAPJOwq4Vh6Kt6&X-Amz-Signature=40d19ec851c492c199a6f752b976087748f558\
  bc9c390e89f275e4a28013fe85&X-Amz-SignedHeaders=host&x-id=GetObject"
series:
  - "Tech"
authors:
  - "é™ˆçŒ›"
tags:
  - "tokenizer"
categories:
  - "LLM"
summary: "å¤§æ¨¡å‹å¦‚ä½•è¯»æ‡‚è‡ªç„¶è¯­è¨€ï¼Œéœ€è¦æˆ‘ä»¬å°†æ–‡æœ¬è½¬æˆæœºå™¨èƒ½è¯»æ‡‚çš„æ•°å­—ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€äº›ä»æ–‡æœ¬åˆ°æ•°å­—çš„ç®—æ³•ã€‚"
NOTION_METADATA:
  object: "page"
  id: "4fc447a4-6527-42ff-86f6-6927e82acd6a"
  created_time: "2023-12-06T02:33:00.000Z"
  last_edited_time: "2023-12-06T06:28:00.000Z"
  created_by:
    object: "user"
    id: "cc08a802-cdc1-4040-b261-957206a41bd5"
  last_edited_by:
    object: "user"
    id: "cc08a802-cdc1-4040-b261-957206a41bd5"
  cover:
    type: "file"
    file:
      url: "https://prod-files-secure.s3.us-west-2.amazonaws.com/d7dbc101-82ce-4f96-a\
        e1a-879bd6c9f3a6/cbbc7f52-197c-4106-9b0f-71c5c7070468/tok_hf.png?X-Amz-\
        Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-\
        Credential=ASIAZI2LB466UQ2LPYSK%2F20250212%2Fus-west-2%2Fs3%2Faws4_requ\
        est&X-Amz-Date=20250212T111842Z&X-Amz-Expires=3600&X-Amz-Security-Token\
        =IQoJb3JpZ2luX2VjEM7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHME\
        UCIQCBmD5j37oGYG9oasznCWtivZvJO7eIqAn7OToT%2FLunqwIgDn6%2Bqb3JGTUnchnDs\
        EKlpn94Ltf6sJgRo9LRQZuxjZMqiAQI5%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGg\
        w2Mzc0MjMxODM4MDUiDOlNmLSRaSeQZvyNhircA8LJK3OwKlOcvIAllgeVCMbTEXBDW3Z38\
        xfxmtGxMI7DDtrcZEwe%2B08IpJ7N3SsKEORmKv%2F2WeAfHsg7hXHPwOkmxS2D%2Fpdxte\
        uJuysdKSxmixrswIoH%2F%2BQ0QTOGvGUGXNLuCtiDCrL1hJzWyBn15PjWNb%2FWkuGZ%2F\
        Fc19NPOib4mwt5pCTsKeAwFqoCryyhHeAPm17d7YKAGPSVqKYQERpbsqs4szTAZu96RN2V5\
        CXjKG2lLxr1HDhjfY1IXuiLnTzltvin4lV4phzozAfZSCK6WZAvXmQDgZmNp0k0fAV%2F9j\
        35g8ZoRUrIwbJkhIXq6ge%2FnbY1ZPRBNSQzr2Cpauihl26w9wbegbAXASU%2FayHsQNhj6\
        KDz4Hy20q7g7xzqOY9QeMc03deoUzdwoOMAyDPW7utewyjUCfcHiQ0B%2Bvrff20VLZgmrZ\
        OJoICd8zkIFrNquF1wF%2FvHTUjWVHEnSL%2FPYiZB09dRido4Ne5vPmiphejlqM4cF8zcL\
        GUwfokJ1OJIsCaZFZmVoSH17iEomuJICaRfKiHIBRRgHkKxT74rY3ZHC6m3UqWmmooiIhMh\
        YOjvlTKm1rjmsc8eqtD15P8YTvoSY4%2BS2p03LpPZRTGUSzAXOI%2Fa0voG48hlvMMHxsL\
        0GOqUB5y9toPo04RRKhSgPa5tCKEGUHP%2B61pNZ0Sg%2FVBNNMrErUSqAFekz70mZx3C3v\
        91pqKiZoRbhai1GPH5AT1jwFW%2B8BphUZ7CT39hcRSif%2ByOabPibOV%2F2k%2Fo7kzc7\
        YjG%2Fs1QP%2BvA4a%2B3UOPaalW5g93VfRD%2BIAIo%2F%2FsxSWBR4bLT2ggQUTS%2FSM\
        ml9Xa%2B3LX8gprtpfLao6B%2FMUj7iAcPRANzPQqLU&X-Amz-Signature=1f37c04896b\
        8dd6a3cb11a63cb02e1955b4940d68b6c480abbf6aa2627d404de&X-Amz-SignedHeade\
        rs=host&x-id=GetObject"
      expiry_time: "2025-02-12T12:18:42.811Z"
  icon: null
  parent:
    type: "database_id"
    database_id: "8d6a6f9d-5a2c-433b-a560-b744eab9db1a"
  archived: false
  in_trash: false
  properties:
    series:
      id: "B%3C%3FS"
      type: "multi_select"
      multi_select:
        - id: "f6345faf-6e79-413e-847a-3fb764a61e06"
          name: "Tech"
          color: "green"
    draft:
      id: "JiWU"
      type: "checkbox"
      checkbox: false
    Created time:
      id: "UBQ%7B"
      type: "created_time"
      created_time: "2023-12-06T02:33:00.000Z"
    authors:
      id: "bK%3B%5B"
      type: "people"
      people:
        - object: "user"
          id: "cc08a802-cdc1-4040-b261-957206a41bd5"
          name: "é™ˆçŒ›"
          avatar_url: "https://s3-us-west-2.amazonaws.com/public.notion-static.com/775523\
            b7-57cf-4c98-8ad8-8777d898666f/notion-avatar-1678713535269.png"
          type: "person"
          person:
            email: "346521888@qq.com"
    custom-front-matter:
      id: "c~kA"
      type: "rich_text"
      rich_text: []
    tags:
      id: "jw%7CC"
      type: "multi_select"
      multi_select:
        - id: "2abdee76-a9ad-41fb-a7c2-4286dc254bdb"
          name: "tokenizer"
          color: "purple"
    categories:
      id: "nbY%3F"
      type: "multi_select"
      multi_select:
        - id: "e417d9a1-8454-498a-b9de-502d57e26681"
          name: "LLM"
          color: "gray"
    summary:
      id: "x%3AlD"
      type: "rich_text"
      rich_text:
        - type: "text"
          text:
            content: "å¤§æ¨¡å‹å¦‚ä½•è¯»æ‡‚è‡ªç„¶è¯­è¨€ï¼Œéœ€è¦æˆ‘ä»¬å°†æ–‡æœ¬è½¬æˆæœºå™¨èƒ½è¯»æ‡‚çš„æ•°å­—ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€äº›ä»æ–‡æœ¬åˆ°æ•°å­—çš„ç®—æ³•ã€‚"
            link: null
          annotations:
            bold: false
            italic: false
            strikethrough: false
            underline: false
            code: false
            color: "default"
          plain_text: "å¤§æ¨¡å‹å¦‚ä½•è¯»æ‡‚è‡ªç„¶è¯­è¨€ï¼Œéœ€è¦æˆ‘ä»¬å°†æ–‡æœ¬è½¬æˆæœºå™¨èƒ½è¯»æ‡‚çš„æ•°å­—ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€äº›ä»æ–‡æœ¬åˆ°æ•°å­—çš„ç®—æ³•ã€‚"
          href: null
    Date:
      id: "zYLY"
      type: "date"
      date: null
    Name:
      id: "title"
      type: "title"
      title:
        - type: "text"
          text:
            content: "å¤§æ¨¡å‹çš„åˆ†è¯ç®—æ³•"
            link: null
          annotations:
            bold: false
            italic: false
            strikethrough: false
            underline: false
            code: false
            color: "default"
          plain_text: "å¤§æ¨¡å‹çš„åˆ†è¯ç®—æ³•"
          href: null
  url: "https://www.notion.so/4fc447a4652742ff86f66927e82acd6a"
  public_url: "https://kevinchen1994.notion.site/4fc447a4652742ff86f66927e82acd6a"
UPDATE_TIME: "2025-02-12T11:19:53.420Z"
EXPIRY_TIME: "2025-02-12T12:19:43.960Z"

---
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css" integrity="sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X" crossorigin="anonymous">


çœ‹äº†ä¸€äº›ä»‹ç»tokenizerç®—æ³•çš„æ–‡ç« ï¼Œæ„Ÿè§‰å¤§å®¶ä»‹ç»çš„æ—¶å€™å¹¶ä¸æ˜¯å¾ˆç³»ç»Ÿï¼Œç”šè‡³æœ‰çš„æ–‡ç« è¿˜æœ‰ä¸€äº›é”™è¯¯ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™ç¯‡æ–‡ç« åšäº†ä¸€ä¸ªæ±‡æ€»ï¼Œæ²¡æœ‰ä¸ªäººåŸåˆ›çš„å†…å®¹ã€‚


| **åˆ†è¯æ–¹æ³•**      | **å…¸å‹æ¨¡å‹**                                                 |
| ------------- | -------------------------------------------------------- |
| BPE           | GPT,GPT-J, GPT-Neo, RoBERTa, BART,  ChatGLM-6B, Baichuan |
| BBPE          |  GPT-2, LLaMA                                            |
| UniLM         | mBART, XLNet                                             |
| WordPiece     | BERT, DistilBERTï¼ŒMobileBERT                              |
| SentencePiece | ALBERT, T5, Flan T5, XLM-RoBERTa                         |


## BPE


> ğŸ’¡ è¾“å…¥ï¼šè®­ç»ƒè¯­æ–™ï¼› è¯è¡¨å¤§å°V  
>   
> 1.å‡†å¤‡è¶³å¤Ÿå¤§çš„è®­ç»ƒè¯­æ–™ï¼Œç¡®å®šæœŸæœ›çš„subwordè¯è¡¨å¤§å°ï¼›  
> 2.å‡†å¤‡åŸºç¡€è¯è¡¨ï¼šæ¯”å¦‚è‹±æ–‡ä¸­26ä¸ªå­—æ¯åŠ ä¸Šå„ç§ç¬¦å·ï¼›  
> 3.åŸºäºåŸºç¡€è¯è¡¨å°†è¯­æ–™ä¸­çš„å•è¯æ‹†åˆ†ä¸ºå­—ç¬¦åºåˆ—å¹¶åœ¨æœ«å°¾æ·»åŠ åç¼€â€œ </ w>â€ï¼›æœ¬é˜¶æ®µçš„subwordçš„ç²’åº¦æ˜¯å­—ç¬¦ã€‚ä¾‹å¦‚å•è¯â€œ lowâ€çš„é¢‘ç‡ä¸º5ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å…¶æ”¹å†™ä¸ºâ€œ l o w </ w>â€ï¼š5ï¼›  
> 4.ç»Ÿè®¡æ¯ä¸€ä¸ªè¿ç»­å­—èŠ‚å¯¹çš„å‡ºç°é¢‘ç‡ï¼Œé€‰æ‹©æœ€é«˜é¢‘çš„å­—ç¬¦å¯¹åˆå¹¶æˆæ–°çš„subwordï¼›  
> 5.é‡å¤ç¬¬4æ­¥ç›´åˆ°è¾¾åˆ°ç¬¬1æ­¥è®¾å®šçš„subwordè¯è¡¨å¤§å°æˆ–ä¸‹ä¸€ä¸ªæœ€é«˜é¢‘çš„å­—èŠ‚å¯¹å‡ºç°é¢‘ç‡ä¸º1ï¼›


ä»£ç å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼ŒçŸ¥ä¹å‡ ä¹æ‰€æœ‰çš„ä»£ç éƒ½æ˜¯æ¥è‡ªäºè¿™é‡Œ


[https://leimao.github.io/blog/Byte-Pair-Encoding/](https://leimao.github.io/blog/Byte-Pair-Encoding/)


```python
'''
https://leimao.github.io/blog/Byte-Pair-Encoding/
'''

import re, collections

def get_vocab(filename):
    vocab = collections.defaultdict(int)
    with open(filename, 'r', encoding='utf-8') as fhand:
        for line in fhand:
            words = line.strip().split()
            for word in words:
                vocab[' '.join(list(word)) + ' </w>'] += 1

    return vocab

def get_stats(vocab):
    pairs = collections.defaultdict(int)
    for word, freq in vocab.items():
        symbols = word.split()
        for i in range(len(symbols)-1):
            pairs[symbols[i],symbols[i+1]] += freq
    return pairs

def merge_vocab(pair, v_in):
    v_out = {}
    bigram = re.escape(' '.join(pair))
    p = re.compile(r'(?<!\S)' + bigram + r'(?!\S)')
    for word in v_in:
        w_out = p.sub(''.join(pair), word)
        v_out[w_out] = v_in[word]
    return v_out

def get_tokens_from_vocab(vocab):
    tokens_frequencies = collections.defaultdict(int)
    vocab_tokenization = {}
    for word, freq in vocab.items():
        word_tokens = word.split()
        for token in word_tokens:
            tokens_frequencies[token] += freq
        vocab_tokenization[''.join(word_tokens)] = word_tokens
    return tokens_frequencies, vocab_tokenization

def measure_token_length(token):
    if token[-4:] == '</w>':
        return len(token[:-4]) + 1
    else:
        return len(token)

def tokenize_word(string, sorted_tokens, unknown_token='</u>'):
    
    if string == '':
        return []
    if sorted_tokens == []:
        return [unknown_token]

    string_tokens = []
    for i in range(len(sorted_tokens)):
        token = sorted_tokens[i]
        token_reg = re.escape(token.replace('.', '[.]'))

        matched_positions = [(m.start(0), m.end(0)) for m in re.finditer(token_reg, string)]
        if len(matched_positions) == 0:
            continue
        substring_end_positions = [matched_position[0] for matched_position in matched_positions]

        substring_start_position = 0
        for substring_end_position in substring_end_positions:
            substring = string[substring_start_position:substring_end_position]
            string_tokens += tokenize_word(string=substring, sorted_tokens=sorted_tokens[i+1:], unknown_token=unknown_token)
            string_tokens += [token]
            substring_start_position = substring_end_position + len(token)
        remaining_substring = string[substring_start_position:]
        string_tokens += tokenize_word(string=remaining_substring, sorted_tokens=sorted_tokens[i+1:], unknown_token=unknown_token)
        break
    return string_tokens

# vocab = {'l o w </w>': 5, 'l o w e r </w>': 2, 'n e w e s t </w>': 6, 'w i d e s t </w>': 3}

vocab = get_vocab('../data/pg16457.txt')

print('==========')
print('Tokens Before BPE')
tokens_frequencies, vocab_tokenization = get_tokens_from_vocab(vocab)
print('All tokens: {}'.format(tokens_frequencies.keys()))
print('Number of tokens: {}'.format(len(tokens_frequencies.keys())))
print('==========')

num_merges = 10000
for i in range(num_merges):
    pairs = get_stats(vocab)
    if not pairs:
        break
    best = max(pairs, key=pairs.get)
    vocab = merge_vocab(best, vocab)
    print('Iter: {}'.format(i))
    print('Best pair: {}'.format(best))
    tokens_frequencies, vocab_tokenization = get_tokens_from_vocab(vocab)
    print('All tokens: {}'.format(tokens_frequencies.keys()))
    print('Number of tokens: {}'.format(len(tokens_frequencies.keys())))
    print('==========')

# Let's check how tokenization will be for a known word
word_given_known = 'mountains</w>'
word_given_unknown = 'Ilikeeatingapples!</w>'

sorted_tokens_tuple = sorted(tokens_frequencies.items(), key=lambda item: (measure_token_length(item[0]), item[1]), reverse=True)
sorted_tokens = [token for (token, freq) in sorted_tokens_tuple]

print(sorted_tokens)

word_given = word_given_known 

print('Tokenizing word: {}...'.format(word_given))
if word_given in vocab_tokenization:
    print('Tokenization of the known word:')
    print(vocab_tokenization[word_given])
    print('Tokenization treating the known word as unknown:')
    print(tokenize_word(string=word_given, sorted_tokens=sorted_tokens, unknown_token='</u>'))
else:
    print('Tokenizating of the unknown word:')
    print(tokenize_word(string=word_given, sorted_tokens=sorted_tokens, unknown_token='</u>'))

word_given = word_given_unknown 

print('Tokenizing word: {}...'.format(word_given))
if word_given in vocab_tokenization:
    print('Tokenization of the known word:')
    print(vocab_tokenization[word_given])
    print('Tokenization treating the known word as unknown:')
    print(tokenize_word(string=word_given, sorted_tokens=sorted_tokens, unknown_token='</u>'))
else:
    print('Tokenizating of the unknown word:')
    print(tokenize_word(string=word_given, sorted_tokens=sorted_tokens, unknown_token='</u>'))

'''
Tokenizing word: mountains</w>...
Tokenization of the known word:
['mountains</w>']
Tokenization treating the known word as unknown:
['mountains</w>']
Tokenizing word: Ilikeeatingapples!</w>...
Tokenizating of the unknown word:
['I', 'like', 'ea', 'ting', 'app', 'l', 'es!</w>']
'''
```


## BBPE


å¯¹äºè‹±æ–‡æ¥è¯´ï¼Œä½¿ç”¨BPEèƒ½å¤Ÿåœ¨è¯è¡¨å¯æ§çš„å‰æä¸‹è§£å†³OOVçš„é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºä¸­æ–‡ã€æ—¥æ–‡ç­‰è¯­è¨€æ—¶ï¼Œç¨€æœ‰æ–‡å­—å¯èƒ½ä¼šä¸å¿…è¦çš„å ç”¨è¯è¡¨å¤§å°ã€‚æ‰€ä»¥BBPEæ–¹æ³•æ˜¯å°†ä¸€æœ¬æ–‡æœ¬çš„UTF-8ç¼–ç ä¸­çš„ä¸€ä¸ªå­—èŠ‚256ä½ä¸åŒç¼–ç ä½œä¸ºè¯è¡¨çš„åˆå§‹åŒ–Subwordã€‚


ç›¸æ¯”ASCIIåªèƒ½è¦†ç›–è‹±æ–‡ä¸­å­—ç¬¦ï¼Œ**UTF-8ç¼–ç åˆ›å»ºçš„æœ¬èº«å°±æ˜¯ä¸ºäº†é€šç”¨çš„å°†ä¸–ç•Œä¸Šä¸åŒçš„è¯­è¨€å­—ç¬¦å°½å¯èƒ½å…¨éƒ¨ç”¨ä¸€å¥—ç¼–ç è¿›è¡Œç¼–å·**ï¼ŒåŒæ—¶ç›¸æ¯”UTF-32å¯¹äºæ¯ä¸ªå­—ç¬¦éƒ½é‡‡ç”¨4ä½å­—èŠ‚ï¼ˆbyteï¼‰è¿‡äºå†—é•¿ã€‚æ”¹è¿›çš„UTF-8ç¼–ç æ˜¯ä¸€ä¸ªå˜é•¿çš„ç¼–ç ï¼Œæœ‰1ï½4ä¸ªèŒƒå›´çš„å­—èŠ‚(bytes)é•¿åº¦ã€‚å¯¹äºä¸åŒè¯­è¨€ä¸­å­—ç¬¦é‡‡ç”¨ä¸åŒé•¿åº¦çš„å­—èŠ‚ç¼–ç ï¼Œä¾‹å¦‚è‹±æ–‡å­—ç¬¦åŸºæœ¬éƒ½æ˜¯1ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ï¼Œä¸­æ–‡æ±‰å­—é€šå¸¸éœ€è¦2ï½3ä¸ªå­—èŠ‚ã€‚


æ ¸å¿ƒæ€æƒ³æ˜¯ç”¨byteæ¥æ„å»ºæœ€åŸºç¡€çš„è¯è¡¨è€Œä¸æ˜¯å­—ç¬¦ã€‚é¦–å…ˆå°†æ–‡æœ¬æŒ‰ç…§UTF-8è¿›è¡Œç¼–ç ï¼Œæ¯ä¸ªå­—ç¬¦åœ¨UTF-8çš„è¡¨ç¤ºä¸­å æ®1-4ä¸ªbyteã€‚ åœ¨byteåºåˆ—ä¸Šå†ä½¿ç”¨BPEç®—æ³•ï¼Œè¿›è¡Œbyte levelçš„ç›¸é‚»åˆå¹¶ã€‚ç¼–ç å½¢å¼å¦‚ä¸‹ã€‚


![](https://prod-files-secure.s3.us-west-2.amazonaws.com/d7dbc101-82ce-4f96-ae1a-879bd6c9f3a6/44df21ab-260b-49d9-b8fb-021817534d3c/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UZC7VWDX%2F20250212%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250212T111944Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEM%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDguXXUU676q1NsDqAMnnF0Mb7llP9wMgYLGgWOJrY2PQIgC3sfoFD9SCuCFyHdhlZA7MMl0sTAp%2BOrciIO6e6vpaMqiAQI6P%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDK8hdl35SJPpEkTCuyrcA4Vr9T354oSon%2BjFBqsI%2B7JNzyVL2YFczuXOYE%2B9NXYHVUEl9G2jvVDjU1i1IlwmrhxSkT4hPCA58KkwXjCrccEH2pQbLXoWyFnqCvRznQdnaj5ohtfZhPZA8SGgisV%2FNDkN9sOI7uqfpJlsJ%2F7eNCoIwUoYwwx%2BWBHEeUFn1m9VwQdMYkTpixMI9TrKLpQdqO4TgHvk72rdYj%2B4rqjxZi3l2mMQOOPOzcjBVVUeDbho2v9fbCkReXjyeCaCxxlBfGHvTitxd74jtc1VMPf21llrM4UP2gXzXORfDtTNy8jfnIsVletpLbqzIj6aEWjrh4%2BipGBoTvbm2Yv3pod9LyryLf%2Brml%2B0ySShYWKJG88%2B%2FOdTxPe8ArYQF8kuur6ePVO9qln2a%2FuuZ2V3B0E%2Bny4CFmJpdDC6JXsGP%2BGCK7mWElniq4ZgAudEfVtpcolWauj1r0hNyad9E%2BOHMPwgZ5M%2FUJVFSjdx7I8%2F%2BoiM3zWy3VelIHcWbaBXGBX4nipFl27DROH7PJpIvoQpW%2FFAYcbx8csEW22xtBsGdcefHOdbLVjdbYZXhgr6vlyO%2BP5dA3nFZBBOn4%2B398T0kjDK%2FD%2F8B6BcUDfSSfEPl%2BUT9pKqkBZ8QduFF0ljNpQvML2Rsb0GOqUB0TnR0hluAJGQqfX%2FskPwxXxo9FH%2FysVLkOf%2Byk0JWJq3SE3HQngE2GPZYbdWeJrIUtpcASSg7D%2FlO4Nal8RQHJT5mDPMoA5okBGn9hjVj5bXG6d72PEu2ehwtFfbrFuwUXh4lm1krpvCsw%2BT49JMYBVecsykCR%2BWZ9yeWRwE9Xda9PZYelSOJUYYztoEu0gkUVHE03gC3Nn97PfKw1WE%2BYwM3CcI&X-Amz-Signature=e4278c8184fc45cb31d32a83b84d8f03e3deb6deba87b6e0dd770c9febb2866f&X-Amz-SignedHeaders=host&x-id=GetObject)


åœ¨è§£ç é˜¶æ®µï¼Œä¸€ä¸ªbyteåºåˆ—å¯èƒ½è§£ç åä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„å­—ç¬¦åºåˆ—ï¼Œè¿™é‡Œéœ€è¦åŠ¨æ€è§„åˆ’è¿›è¡Œè§£ç ï¼Œä½¿å…¶èƒ½è§£ç å‡ºå°½å¯èƒ½å¤šçš„åˆæ³•å­—ç¬¦ã€‚æ‰€ä»¥BBPEè™½ç„¶è§£å†³äº†ä¸­æ–‡ã€æ—¥æ–‡è¯è¡¨è¿‡å¤§çš„é—®é¢˜ï¼Œä½†æ˜¯è§£ç ä¸Šè¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜ã€‚


## **WordPiece**


> ğŸ’¡ è¾“å…¥ï¼šè®­ç»ƒè¯­æ–™ï¼› è¯è¡¨å¤§å°V  
>   
> 1.å‡†å¤‡è¶³å¤Ÿå¤§çš„è®­ç»ƒè¯­æ–™ï¼Œç¡®å®šæœŸæœ›çš„subwordè¯è¡¨å¤§å°ï¼›  
> 2.å‡†å¤‡åŸºç¡€è¯è¡¨ï¼šæ¯”å¦‚è‹±æ–‡ä¸­26ä¸ªå­—æ¯åŠ ä¸Šå„ç§ç¬¦å·ï¼›  
> 3.åŸºäºåŸºç¡€è¯è¡¨å°†è¯­æ–™ä¸­çš„å•è¯æ‹†åˆ†ä¸ºæœ€å°å•å…ƒ;  
> 4.åŸºäºç¬¬3æ­¥æ•°æ®è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼Œå¯ä»¥æ˜¯æœ€ç®€å•çš„unigramè¯­è¨€æ¨¡å‹ï¼Œé€šè¿‡æå¤§ä¼¼ç„¶è¿›è¡Œä¼°è®¡å³å¯;  
> 5.ä»æ‰€æœ‰å¯èƒ½çš„subwordå•å…ƒä¸­é€‰æ‹©åŠ å…¥è¯­è¨€æ¨¡å‹åèƒ½æœ€å¤§ç¨‹åº¦åœ°å¢åŠ è®­ç»ƒæ•°æ®æ¦‚ç‡çš„å•å…ƒä½œä¸ºæ–°çš„å•å…ƒ;  
> 6.é‡å¤ç¬¬5æ­¥ç›´åˆ°è¾¾åˆ°ç¬¬2æ­¥è®¾å®šçš„subwordè¯è¡¨å¤§å°æˆ–æ¦‚ç‡å¢é‡ä½äºæŸä¸€é˜ˆå€¼;


WordPieceç®—æ³•è·ŸBPEç®—æ³•æµç¨‹åŸºæœ¬ä¸€è‡´ï¼ŒBPEæ˜¯åŸºäºæœ€é«˜è¯é¢‘æ¥ç”ŸæˆSubwordï¼Œè€ŒWordPieceæ˜¯åŸºäºæ¦‚ç‡æ¥ç”ŸæˆSubwordã€‚å…·ä½“æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªè¯ä¸ºzï¼Œzç”±xå’Œyç»„æˆï¼Œå¯¹æ¯”P(Z)çš„æ¦‚ç‡å’ŒP(X)+P(Y)çš„æ¦‚ç‡ï¼Œå¦‚æœ<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>Z</mi><mo stretchy="false">)</mo><mo>&gt;</mo><mi>P</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>+</mo><mi>P</mi><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(Z)&gt;P(X)+P(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>ï¼Œåˆ™åˆå¹¶xå’Œyï¼Œå› ä¸ºä»–ä»¬å…·æœ‰æœ€çš„äº’ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯åœ¨è¯­è¨€æ¨¡å‹ä¸Šå…·æœ‰è¾ƒå¼ºçš„å…³è”æ€§ã€‚


æˆ‘ä»¬å‡è®¾å¥å­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>t</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>t</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S=(t_1,t_2,...,t_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>ï¼Œå…¶ä¸­<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">t_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä»£è¡¨ä¸€ä¸ªå­è¯ï¼Œä¸”å‡è®¾å„ä¸ªå­è¯ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹å­˜åœ¨çš„ï¼Œé‚£ä¹ˆå¥å­çš„è¯­è¨€æ¨¡å‹ä¼¼ç„¶å€¼ç­‰ä»·äºæ‰€æœ‰å­è¯æ¦‚ç‡çš„ä¹˜ç§¯ã€‚


<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>P</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mi>i</mi><mi>n</mi></munderover><mi>l</mi><mi>o</mi><mi>g</mi><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">logP(S) = \sum_{i}^nlogP(t_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>


å‡è®¾æŠŠç›¸é‚»ä½ç½®çš„xå’Œyä¸¤ä¸ªå­è¯è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶åäº§ç”Ÿçš„æ–°çš„å­—è¯ä¸ºzï¼Œæ­¤æ—¶å¥å­Sçš„ä¼¼ç„¶å€¼å˜åŒ–å¯ä»¥è¡¨ç¤ºä¸ºï¼š


<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="false">)</mo><mo>âˆ’</mo><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>x</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>y</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>x</mi></msub><mo stretchy="false">)</mo><mi>P</mi><mo stretchy="false">(</mo><msub><mi>t</mi><mi>y</mi></msub><mo stretchy="false">)</mo></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">logP(t_z)-(logP(t_x)+logP(t_y))=log(\frac{P(t_z)}{P(t_x)P(t_y)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3991em;vertical-align:-0.9721em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span>


ä»ä¸Šé¢çš„å…¬å¼å¯ä»¥å‘ç°ï¼Œä¼¼ç„¶å€¼çš„å˜åŒ–å°±æ˜¯ä¸¤ä¸ªå­è¯çš„äº’ä¿¡æ¯ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒWordPieceæ¯æ¬¡é€‰æ‹©åˆå¹¶çš„ä¸¤ä¸ªå­è¯ï¼Œä»–ä»¬å…·æœ‰æœ€å¤§çš„äº’ä¿¡æ¯å€¼ï¼Œä¹Ÿå°±æ˜¯ç›¸å…³å­—è¯åœ¨è¯­è¨€æ¨¡å‹ä¸Šå…·æœ‰è¾ƒå¼ºçš„å…³è”æ€§ï¼Œä»–ä»¬ç»å¸¸åœ¨è¯­æ–™ä¸­ä»¥ç›¸é‚»çš„æ–¹å¼åŒæ—¶å‡ºç°ã€‚


## UniLM


> ğŸ’¡ è¾“å…¥ï¼šè®­ç»ƒè¯­æ–™ï¼›è¯è¡¨å¤§å°Vï¼› ä¿ç•™é˜ˆå€¼Xï¼›  
>   
> 1.å‡†å¤‡åŸºç¡€è¯è¡¨ï¼šåˆå§‹åŒ–ä¸€ä¸ªå¾ˆå¤§çš„è¯è¡¨ï¼Œæ¯”å¦‚æ‰€æœ‰å­—ç¬¦+é«˜é¢‘Ngramï¼Œä¹Ÿå¯ä»¥é€šè¿‡BPEç®—æ³•åˆå§‹åŒ–ï¼›  
> 2.é’ˆå¯¹å½“å‰è¯è¡¨ï¼Œç”¨è¯­è¨€æ¨¡å‹ï¼ˆunigram lm)ä¼°è®¡æ¯ä¸ªå­è¯åœ¨è¯­æ–™ä¸Šçš„æ¦‚ç‡ï¼›  
> 3.è®¡ç®—åˆ é™¤æ¯ä¸ªSubwordåå¯¹æ€»lossçš„å½±å“åŠScoreå¾—åˆ†ï¼Œä½œä¸ºè¯¥Subwordæ’åºçš„Scoreå¾—åˆ†ï¼›  
> 4.å°†å­è¯æŒ‰ç…§Scoreå¤§å°è¿›è¡Œæ’åºï¼Œä¿ç•™å‰X%çš„Subwordï¼›æ³¨æ„ï¼Œå»ºè®®å•å­—ç¬¦çš„Subwordä¸èƒ½è¢«ä¸¢å¼ƒï¼Œä»¥å…OOVï¼›  
> 5.é‡å¤æ­¥éª¤2åˆ°4ï¼Œç›´åˆ°è¯è¡¨å¤§å°å‡å°‘åˆ°è®¾å®šå€¼ï¼›


UniLMå¯ä»¥çœ‹æˆæ˜¯WordPieceç®—æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œåå‘æ“ä½œã€‚ç›¸æ¯”WordPieceå€ŸåŠ©è¯­è¨€æ¨¡å‹é€‰æ‹©åˆå¹¶è®¡ç®—æ¦‚ç‡æœ€å¤§çš„ç›¸é‚»å­—ç¬¦å¯¹åŠ å…¥è¯è¡¨ä¸­ä½œä¸ºæ–°çš„Subwordï¼ŒUniLMæ˜¯å¼€å§‹æ—¶å…ˆæ„å»ºè¶³å¤Ÿå¤§çš„è¯è¡¨ï¼Œä¹‹åæ¯ä¸€æ­¥é€‰æ‹©ä¸€å®šæ¯”ä¾‹çš„è®¡ç®—æ¦‚ç‡ä½çš„Subwordä»è¯è¡¨ä¸­åˆ é™¤ã€‚å› æ­¤è¿‡ç¨‹ä¸­æ¯”è¾ƒæ˜¾è‘—å·®åˆ«æ˜¯WordPieceç®—æ³•çš„è¯è¡¨åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­æ˜¯ä»å°åˆ°å¤§çš„å˜åŒ–ï¼Œè€ŒUniLMçš„è¯è¡¨åˆ™æ˜¯ä»å¤§åˆ°å°çš„å˜åŒ–ï¼Œæ•´ä¸ªè¿‡ç¨‹æ ¹æ®è¯„ä¼°ä¸æ–­åˆ é™¤æ’åºé åçš„Subwordç›´åˆ°è¯è¡¨å¤§å°å‡å°‘åˆ°è®¾å®šå€¼ã€‚


## **SentencePiece**


SentencePieceæ˜¯Googleæ¨å‡ºçš„åˆ†è¯å·¥å…·ï¼Œè¿™ä¸ªåŒ…ä¸»è¦æ˜¯ä¸ºäº†å¤šè¯­è¨€æ¨¡å‹è®¾è®¡çš„ï¼Œä½¿ç”¨unicodeç¼–ç ï¼Œè§£å†³äº†å¤šè¯­è¨€ç¼–ç æ–¹å¼ä¸åŒçš„é—®é¢˜ã€‚

- å†…ç½®BPEï¼ŒUnigramï¼Œcharå’Œwordçš„åˆ†è¯æ–¹æ³•
- æ— éœ€é¢„åˆ†è¯ï¼Œä»¥unicodeæ–¹å¼ç›´æ¥ç¼–ç æ•´ä¸ªå¥å­ï¼Œç©ºæ ¼ä¼šè¢«ç‰¹æ®Šç¼–ç ä¸ºâ–
- ç›¸æ¯”ä¼ ç»Ÿå®ç°è¿›è¡Œä¼˜åŒ–ï¼Œåˆ†è¯é€Ÿåº¦é€Ÿåº¦æ›´å¿«

ä¸­æ–‡llamaæ¨¡å‹ä½¿ç”¨çš„å°±æ˜¯SentencePieceè¿›è¡Œæ‰©å……ä¸­æ–‡è¯è¡¨ã€‚å…·ä½“æµç¨‹ä¸ºï¼šå…ˆä½¿ç”¨å¤§é‡çš„ä¸­æ–‡é¢„æ–™è¿›è¡Œè®­ç»ƒä¸­æ–‡tokenizeræ¨¡å‹ï¼Œç„¶åå°†ä¸­æ–‡æ¨¡å‹ä¸llama tokenizeræ¨¡å‹è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶ä»£ç ï¼š


[https://github.com/ymcui/Chinese-LLaMA-Alpaca/blob/main/scripts/merge_tokenizer/merge_tokenizers.py](https://github.com/ymcui/Chinese-LLaMA-Alpaca/blob/main/scripts/merge_tokenizer/merge_tokenizers.py)


## å‚è€ƒæ–‡ç« 


[https://mp.weixin.qq.com/s/Sgz74bSs0saCFhw1GOaMnw](https://mp.weixin.qq.com/s/Sgz74bSs0saCFhw1GOaMnw)


[https://zhuanlan.zhihu.com/p/86965595](https://zhuanlan.zhihu.com/p/86965595)


[https://zhuanlan.zhihu.com/p/649030161](https://zhuanlan.zhihu.com/p/649030161)


[https://zhuanlan.zhihu.com/p/651430181](https://zhuanlan.zhihu.com/p/651430181)


[https://huggingface.co/docs/transformers/tokenizer_summary](https://huggingface.co/docs/transformers/tokenizer_summary)

